<strong>DScript Documentation</strong></h1><p>This file is still a work of progress but mainly made up by the info in the main thread at <a href="https://www.ttlg.com/forums/showthread.php?t=147713">www.ttlg.com</a>.</p>

<blockquote class="postcontent restore ">
<br>
<a href="https://www.dropbox.com/s/4z6onzifsp785vy/DT2UndercoverWeapons.nut?dl=1" target="_blank">T2 Weapon replacement scripts for DImUndercover .nut file</a><br>
<br>
Designed for Thief 2. Should be usable in T1/G and SS as well.<br>
I think the ^ operator will not work in T1.<br>
<br>
<b><u>Current Scripts</u><br>
<br>
DHub<br>
DCompileTrap<br>
DBaseTrap</b> (Framework for all other scripts, all standard Parameters are explained there)<b><br>
DRelayTrap<br>
-DStdButton<br>
-DHitScanTrap<br>
<br>
DGoMissing<br>
DImUndercover<br>
<br>
DRay<br>
DArmAttachment<br>
DHudCompass<br>
DDrunkPlayerTrap <br>
<br>
DWatchMe<br>
DCopyPropertyTrap<br>
DAddScript<br>
<br>
</b>The standard TrapTeleporter always forces the camera to adjust to the  facing of the TrapObject, therefore seamless transition via scripts was  first not possible, only via S&amp;R or later via telliameds TrapMoveRelative script.<b><br>
DTeleportPlayerTrap<br>
DTrapTeleporter<br>
DPortal<br>
<br>
DEditorTrap</b>(you will find the documentation at the bottom for the .nut file as this script if wrongly used can harm your map.)<br>
<br>
DDumpModels (extra file)<br>
------------------<br>
<br>
<b>Script Changes</b><br>
•<b>DRelayTrap</b><br>
now also accepts DRelayTrap[On/Off]TDest for On/Off specific Targets to more familiarity to NVRelayTrap. (Valuable Targeting parameters are either []Target or []TDest)<br>
<br>
<br>
<b>Script Addition</b><br>
<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DStdButton</b> (DRelayTrap)<br>
DStdButton has all the StdButton features- even TrapControlFlags work. <u>Once</u> will lock the Object - as well as the DRelayTrap features, so basically this can save some script markers which only wait for a Button TurnOn<br>
<br>
Additional:<br>
If the button is locked the joint will not activate and the Schema specified by <font color="#0000FF">DStdButtonLockSound</font> will be played, by default <u>"noluck"</u> the wrong lockpick sound.
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DAddScript</b><font size="1"><br>
<font color="#FF8C00">Can be used as Root -&gt; D[Add/Remove]ScriptFunc</font></font><br>
<br>
Adds the Script specified by <font color="#0000FF">DAddScriptScript</font> to the objects specified by <font color="#0000FF">DAddScriptTarget</font>, by default <u>&amp;ControlDevice</u>.<br>
Additionally it sets the DesignNote via <font color="#0000FF">DAddScriptDN.</font>. If Script parameter is not set only the DesignNote is added/changed.<br>
<br>
On <u>TurnOff</u> will clear the Script 4 slot.<br>
<br>
NOTE:<br>
• It will try to add the Script in Slot 4. It will check if its empty or in case if it's not if the Archetype has it, else you will get an error and should use a Metaproperty.<br>
• It is possible to only change the DesignNote with this script and so change the behavior of other scripts BUT this only works for non-squirrel scripts!<br>
• Using Capacitor or Count for will not work for newly added DScripts. As these are created and kept clean in the Editor.
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DArmAttachment</b><br>
<br>
Attaches another object to the players arm.<br>
<br>
So when using an empty hand model you can create your own custom weapons. It can be given to any weapon-ready object together with <b>Inventory-&gt; Limb Object: emptyhan or BJACHAND </b> (Both Models included, made by Jason Otto and Soul Tear).<br>
OR you can also add it to normal weapons to attach a Shield or Light or whatever creative stuff you come up with <img src="images/smilies/wink.gif" alt="" title="Wink" class="inlineimg" border="0"><br>
<br>
Parameters:<br>
<font color="#0000FF">DArmAttachmentUseObject</font>: <br>
= 0 (Default): Will create a dummy object and give it the Shape-&gt;Model: <font color="#0000FF">DArmAttachmentModel</font><br>
= 1 Will create a copy of a real object/archetype specified in <font color="#0000FF">DArmAttachmentModel</font>. If you want to attach special effects for example.<br>
= 2 (experimental and not really working): Same as 1 but the object will be really physical -&gt; Real collision sounds based on the object.<br>
= 3 (experimental little working): Same as 2 but works even better. Disadvantage: Errors in DromED, Model will pass through walls/objects.<br>
<br>
<font color="#0000FF">DArmAttachmentModel</font>: model name(0) or object Archtype (1) depending on (DArmAttachmentUseObject)<br>
<font color="#0000FF">DArmAttachmentRot</font> and <font color="#0000FF">DArmAttachmentPos</font>: The model will most likely need some adjustments in position and Rotation. Both parameters take 3 arguments separated by , like this: "90,0,0" or "0.1,-0.6,-0.43". They stand for HPB Roation respectively xyz translation. But most like don't behave like you expect it. Best method how to figure out the numbers is to use it in combination with set game_mode_backup 0 (<b>NEVER SAVE AFTER!</b>) and modify the DetailAttachment Link. It's trial and error.<br>
<br>
NOTE: You will also need to do some Hierarchy changes to adjust the sound and motions. Also I would say this script is not 100% finished please give feedback.<br>
TIP: Remember you can use multiple different melee weapons by using the cycle command. Or design them so that you can also use them from the normal inventory.<br>
<br>
<img src="https://www.dropbox.com/s/htdofcgz71wm09x/WeaponAttach.gif?raw=1" alt="" onload="NcodeImageResizer.createOn(this);" border="0"><br>
			
		</div>
	</div>
</div><br>
Second<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DHitScanTrap</b> (extends DRelayTrap)<br>
(Has the DRelayTrap sending features: [On/Off]Target or [On/Off]TDest)<br>
When activated will scan if there is an object or a wall between two objects. Imagine it as an invisible scanning laser beam. The start and end object are specified by <font color="#0000FF"><b>DHitScanTrapFrom</b></font> and <b><font color="#0000FF">DHitScanTrapTo</font></b>, the script object is used as default if none is specified. <br>
If the From object is the player the camera position is used, if the To object is the player as well then the ray will follow the center of the players view - for example to check if hes exactly facing something.<br>
<br>
The Object that was hit will receive the message specified by <font color="#0000FF">DHitScanTrapHitMsg</font> (default is "<i><font color="#808080">DHitScan</font></i>"). By default when any object is hit a <u>TurnOn</u> will be sent to <u>CD</u> linked objects. Of course these can be changed via <font color="#0000FF">DHitScanTrapTOn</font> and <font color="#0000FF">DHitScanTrapTDest</font><br>
Alternatively if just a special set of objects should trigger a <u>TurnOn</u> then these can be specified via <font color="#0000FF">DHitScanTrapTrigger</font>. <b>THIS WAS CHANGED in 0.28a from Target to Trigger!!!</b><br>
<br>
NOTE: Unlike other scripts DHitScanTrapFrom and To only take single objects at the moment. I can add multiple object support as well but<br>
NOTE2: The scanning is described as an rather expensive progress. So don't use it like 100 times per second over long distances. Best to only activate it when you need it. (That's why this is no real Trigger)
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DRay</b><br>
Working with a template particle effect defined by <font color="#0000FF">DRaySFX</font>, this script creates and scales particle effects between objects specified by <font color="#0000FF">DRayFrom</font> and <font color="#0000FF">DRayTo</font>. with the + or similar operator you can create multiple and different SFX between multiple objects at once.<br>
For all effects only the X values and Particle Launch Infos are used!<br>
Sending further <u>TurnOn</u> messages will not create additional SFX but update the already present ones.<br>
<br>
Primarily two types are supported:<br>
<font color="#0000FF">DRayScaling</font>: <br>
= 0 (Default): For even particle effects. This will scale up their spawn box and the particles used. A small effect with look exactly like a big one.<br>
= 1: For "shooting" Particle effects which start at the From location. Increases particle lifetime. (Min=Max)<br>
<br>
<u>TIPS:</u><br>
• A good template is the ParticleBeam(-3445)<br>
• You can use this script in the editor with an appropriate <font color="#0000FF">DRayOn</font> message. For example "test" (use script_test objId) or Sim (objects will be created after leaving game mode) and then delete the script object.<br>
• By using <b>Particles Start Launched</b> you can create very different and more solid effects but they will be less accurate in hitting the To object.<br>
• You can either use an infinite repeating TurnOn from an outside Trap or <font color="#0000FF">DRayRepeat=-1</font> to constantly update your special effects in case the objects are changing positions.<br>
• If you don't want to turn off the special effect the second method is better else I recommend the first. (Else you would need +TurnOff+TurnOff+TurnOn sequence to deactivate the script completely.<br>
<br>
• When using launched very fast particles (like the laser in the video) the effect degenerates after a few seconds, so sending a "+TurnOff+TurnOn" with DRayOffCapacitor=50 will update the effect 50 times and then create a new one. The capacitor doesn't have to be that high but without to much performance is used to calculate the launched particles!!! (and it's a more smoother as well)<br>
• My Demo effects are rather simple, be creative with the particle settings, share your stuff if you for example created a spiral or or or...<img src="images\smilies\biggrin.gif" alt="" title="Big Grin" class="inlineimg" border="0"><br>
			
		</div>
	</div>
</div>All paricles are created with DRay and the damage detection with DHitScan<video controls="controls" width="640" height="480"><br>
<source src="http://dl.dropboxusercontent.com/s/kr3nxz9mlm965p3/Dark%20Projekt%2008.01.2017%20-%2000.15.19.09.mp4?dl=0" type="video/mp4"><br>
</video><br>
<br>
<br>
<br>
<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DDumpModels</b><br>
Included in the DDumpModel.nut read the instructions for more detailed information. Or in this post <a href="http://www.ttlg.com/forums/showthread.php?t=148055&amp;p=2366253&amp;viewfull=1#post2366253" target="_blank">here</a><br>
<br>
Basically it will create the models from your obj folder and place them in the editor.<br>
The parameters used are exactly as written here:<br>
<br>
First= the model name of the first model you want to use; if it's a number it will start with for example the 100th model in your list.<br>
MaxModels = will stop after for example 2000 have been created.<br>
Screenshots=1 will automatically create screenshots in game mode while creating the models.<br>
			
		</div>
	</div>
</div>-----------------------------------------<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DBaseTrap</b><br>
This script is the base framework for every other script, by itself it has no use but will handle the generic Parameters for the other scripts. Every Parameter explained here has to be put into the Editor-&gt;Design Note separated from the next via <b>;</b>. They will work for every other script and DHub[Message]="Actions", not the DHub alone.<br>
<br>
Normally scripts react to <u>TurnOn</u> and <u>TurnOff</u> messages. With <i><font color="#0000FF">[ScriptName]On/Off="YourMessage"</font></i> you can define other messages this script will react to.<br>
It is possible for a script to react to more than one <u>TurnOn/Off</u> message. In such a case each message needs a + before them like: DRelayTrapOn="+TurnOn+FrobWorldBegin+Damage"<br>
<br>
<font color="#FF8C00">Squirrel Note:</font>It is possible for a script to have another On/Off default message. You can specify this with <font color="#FF8C00"><i>DefOn="CustomTurnOn"</i></font> or <font color="#FF8C00"><i>DefOff="YourOff"</i></font> anywhere in your script class but outside of functions. Messages specified in the Design Note have priority. DWatchMe is currently the only exception which uses BeginScript instead of TurnOn<br>
<br>
As a matter of fact this lets you simulate 3 <b>Trap Control Flags</b> <i>NoOn, NoOff, Invert</i> - NOTE: The standard Trap Control Flags set with the object property have no effect on DScripts.<br>
<br>
You can use <i><font color="#0000FF">[ScriptName]On="TurnOff";[ScriptName]Off="TurnOn"</font></i> to simulate <i>Invert</i>; <i><font color="#0000FF">[ScriptName]On="Null"</font></i> can be used to simulate <i>NoOn</i> and <i><font color="#0000FF">[ScriptName]Off="Null"</font></i> can be used to simulate <i>NoOff</i>.<br>
Remember that if you specify <font color="#0000FF"><i>[ScriptName]On="TurnOff"</i></font> without specifying <i><font color="#0000FF">[ScriptName]Off</font></i>, then TurnOff will perform the On as well as the Off action.<br>
<br>
<font color="#0000FF">[ScriptName]Count</font><br>
Use this parameter to specify the maximum number of times that the script will work. You can use <font color="#0000FF">[ScriptName]Count=1</font> to emulate the Once Trap Control Flag. The default is 0 (infinite).<br>
Both <u>TurnOn</u> and <u>TurnOff</u> are counted by default. You can use <font color="#0000FF">[ScriptName]CountOnly=1</font> to count only <u>TurnOn</u>, and <font color="#0000FF">[ScriptName]CountOnly=2</font> to count only <u>TurnOff</u> - the respectively other message will still have their full effect even if the Count is full. Sending the trap a <u>ResetCount</u> message will reset the counter. <br>
<br>
<font color="#0000FF">[ScriptName][On/Off]Capacitor</font><br>
Use this parameter to specify the number of times that a trap will need to receive its triggering message before it activates. For example, an NVRelayTrap with NVRelayTrapCapacitor=3 will only relay every third message, while one with NVRelayTrapOnCapacitor=4; NVRelayTrapOffCapacitor=2 will relay every second TurnOff message but only every fourth TurnOn message. The default is 1.<br>
<font color="#0000FF">[ScriptName][On/Off]CapacitorFalloff</font> can be used to specify the time, in [seconds], that it takes for the trap to "lose charge", and the activation count to go back down by one activation.<br>
<br>
<b>NOTE 1: Count and Capacitor data are refreshed on script_reload and <i>exiting</i> game_mode. Therefore I suggest that you insert the script_reload command into your GameMode.cmd<br>
NOTE 2: All Capacitor parameters don't interfere with each other. For example setting Capacitor=<font color="#FF0000">3</font> and OnCapacitor=<font color="#00FF00">2</font> and  then receiving TurnOff,TurnOff,<font color="#FF0000">TurnOn</font>,<font color="#00FF00">TurnOn</font> will relay both TurnOn messages as the first TurnOn is the <font color="#FF0000">3rd</font> message and the 2nd is the <font color="#00FF00">2nd</font> TurnOn</b>.<br>
Same goes for CapacitorFalloff it won't decrease an OnCapacitor only OnCapacitorFalloff will do.<br>
---<br>
<br>
<font color="#0000FF">[ScriptName]Delay</font><br>
Setting this to a value greater 0 will postpone the action performed by this script by the specified number in <i>seconds</i>. <font color="#0000FF">[ScriptName]Delay=0.5</font> for example would delay the action by 500ms.<br>
By setting <font color="#0000FF">[ScriptName]ExlusiveDelay=1</font> the script will abort the still being delayed action and will start the Delay at 0 again. This is for example useful if you want a script to react to Water Arrows or entering a Room/OBB where due to the engine multiple On messages are sent in a very short time.<br>
<br>
<font color="#0000FF">[ScriptName]Repeat</font><br>
If you want a script to repeat it's actions multiple times you can set this parameter. By default it is 0 for none. The time between repeats is specified with <font color="#0000FF">[ScriptName]Delay</font>.<br>
Infinite repeats are declared via <font color="#0000FF">[ScriptName]Repeat=-1</font> and will be stopped by the corresponding other message. A infinite repeating <u>TurnOn</u> will be stopped by a <u>TurnOff</u>. This single TurnOff will only stop the repeat and will <i>not</i> perform the DoOff action of the script. Only a second TurnOff will trigger it.<br>
<br>
<font color="#0000FF">[ScriptName]FailChance</font> <br>
A chance (from 1 to 100 or -100 to -1) that the specific script will not activate. If you define a negative value Capacitor and Counts will still be increased first and then tested if the script will fail or not.<br>
<br>
If a script is looking for an object parameter for example <font color="#0000FF">[ScriptName]Target</font> you can use the following expressions. $QVar can be used for all Parameters as it represents a number for example DRelayTrapRepeat="$MyQVar"<br>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:240px;">[me]                the object itself
[source]            the object that sent the triggering message
&amp;LinkFlavor            all linked objects with the specific link.
*Archetype/MetaProp        all concrete objects directly descending from the given Archetype
@Archetype/MetaProp        all concrete objects given Archetype and all of its descendants
^Archetype/MetaProp/Name    finds the closest object.
$QVar            will sent to the object with the number stored in the Quest Variable QVar

//Something NEW: little but powerful
+Everything         Single objects and combinations of the other types.
+-Everything        Remove a previously added subset.

When using the + operator you need a # before pure object/archetype numbers, also for example "+#42+#-17"

    Example: 
    •Target="+[me]+&amp;~ControlDevice+@M-DoesPatrol+coolguy+#42"
        This will give back the object itself, all ~ControlDevice'd linked objects, every object with the MetaProperty M-DoesPatrol, the object named coolguy and the object with the number 42. IMPORTANT: if you want to address a pure object number you need # before it. (Only needed in combination with +)
    •Target="+@guard+-@M-FrontGateGuard+-@M-TopFloorGuard"</pre>
</div>Note: Even if only one object is needed like for DCopyPropertySource="&amp;LinkFlavour" you will only get the object with the highest LinkID (needs confirmation) that you will get only one is for sure.<br>
<br>
<b>Design Note Examples</b><br>
DTeleportPlayerTrapOn="TurnOff"<br>
DTrapTeleporterOn="FireStimStimulus"<br>
DRelayTrapRepeat="$MyQVar"<br>
<br>
<b>Note/Tip</b><br>
From my testings Scripts from different .nut are shared, so you could also use <font color="#FF8C00">extend DBaseTrap</font> in your files without having to creating a new class yourself.
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DHub</b><br>
(not a DBaseTrap script)<br>
will by default send a <u>TurnOn</u> at <u>ControlDevice</u>d linked objects when it receives a valid message. Valid messages are declared in the DesignNote like this: <font color="#0000FF">DHub[Message]="Parameter1=Value1;Parameter2=Value2"</font>. Even if you want to use the default options a minimal <font color="#0000FF">DHub[Message]="=="</font> is necessary! The + operator does not work here.<br>
Multiple actions can be declared for the same Message via <font color="#0000FF">DHub[Message]2="Parameter1=Value1;...</font>. The used numbers must be consecutive! If there is a gap all above numbers will be skipped. There is no maximum to different actions a Message can have.<br>
<br>
Parameters are basically identically to the ones by <font color="#808080">DBaseTrap</font> or <font color="#808080">DRelayTrap</font> beside [T]On/Off.<br>
<b>NOTE:!</b>Parameters require no prefix. String values may not have " " around them!!! And I don't recommend blank spaces anywhere inside the "Parameter=Value;P2=V2" declaration, only if you want to address an object like Target=@false label<br>
<br>
The valid parameters - all operators like +,@,$... will work here<br>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:132px;">Relay            What message(s) should be sent. Like for DRelayTrap there is stim support like [3.7]FireStim.
Target            To which object(s)
Delay            will delay the message and also defines the time between repeats.
ExclusiveDelay        When set to =1 will abort messages from this action which are still waiting to be sent.
Repeat            how often should the action be repeated. Repeat=-1 for infinitely. <i>All</i> Infinite repeats can be stop via a <u>StopRepeat</u>. A single action (repeat must not be infinite) via <u>[Message+number]StopRepeat</u>.
Count            The maximum number of times a action will be executed. Default =0 infinitely. <i>All</i> counts can be reset via a <u>ResetCount</u> message. Single action counts like above with via <u>[Message+number]ResetCount</u>.
Capacitor        The number of times this action will need to receive its triggering before executing. Default = 1 everytime. 
CapacitorFalloff     The time in seconds after the Capacitor will go down by 1. Default =0
FailChance        A chance (from 1 to 100 or -100 to -1) that this action be executed. If the number is negative Capacitor and Counts will still be increased first and then tested if the script will fail or not.</pre>
</div>Default Parameter:<br>
By setting <font color="#0000FF">DHub[Parameter]="Value"</font>. This Parameter will be default for all actions if not specified otherwise.<br>
As an example and as script default DHubRelay="TurnOn";DHubTarget="&amp;ControlDevice".<br>
<br>
<b>Design Note example</b><br>
<img src="https://www.dropbox.com/s/nzwt7tzhxgremuo/DHubExample.jpg?raw=1" alt="" onload="NcodeImageResizer.createOn(this);" border="0">
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DHudCompass</b><br>
Upon receiving <u>FrobInvEnd</u> will clone the current selected object and attach it slightly below the players camera and keep its facing always to north.<br>
By default there is no <u>TurnOff </u>as it is TurnedOff via toggling.<br>
<br>
<b>Engine Features -&gt; Frob Info &gt; Inv Action: Script must be set.</b><br>
<br>
I suggest scaling down the object to 10-50%.<br>
<img src="https://www.dropbox.com/s/dsp0xu1lc367vvs/DHudCompass.gif?raw=1" alt="" onload="NcodeImageResizer.createOn(this);" border="0">
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DCompileTrap</b><br>
On <u>TurnOn</u> tries to compile the Editor Comments.<br>
This script lets you write your own squirrel commands inside the editor.<br>
<br>
It uses Editor Comment because the Squirrel line/command end <b>;</b> also indicates a new Parameter in the Design Note which do interfere, also you are able to use newlines much easier. But the newlines(made by enter) will be translated to \n and to not destroy your code you need to comment these \n out with a /* at the end of the line and */ at the start of the next<br>
<br>
<br>
<b>Editor Comment example:</b><br>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:60px;">ActReact.Stimulate(Object.Named("player"),"BashStim",20);/* now comes a new line
*/DarkUI.TextMessage("String made by DCompileTrap");/*
*/DarkGame.KillPlayer()</pre>
</div>
			
		</div>
	</div>
</div><br>
<font color="#A52A2A"><b><br>
Squirrel changes: (See also end of this post)</b></font><br>
--DGetParam removed the single parameter as now everything undergoes a string check handled by DCheckString and returns a single obj,string unless adv=1 is set, then an array is returned.<br>
--All DoOn,DoOff functions will now take the DesignNote as a parameter to save internal extra calls.<br>
--Removed most of the basic functions from the DBaseTrap so you can access them in other .nut files without using extend DBaseTrap.<br>
<br>
<br>
-------------------------------------------------------------------------<br>
<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DRelayTrap</b><br>
<font size="1"><font color="#FFA500">Can be used as Root -&gt; DSendMessage; DRelayMessages</font></font><br>
A relay with all the DBaseTrap features. On <u>TurnOn</u> it will relay the message specified with <font color="#0000FF">DRelayTrapTOn</font>. Respectively the on <u>TurnOff</u> to be sent messages can be specified with <font color="#0000FF">DRelayTrapTOff</font>. By default these are TurnOn and TurnOff.<br>
With the + operator you can define multiple On, TOn, Off and TOff messages.<br>
With <font color="#0000FF">DRelayTrap[On/Off]Target</font> (NEW: Also [On/Off]TDest works as an alternative) you can specify where to sent the message(s) to. Default are <u>ControlDevice</u> linked objects. If <font color="#0000FF">DRelayTrap<b>On</b>Target</font> is specified then it will take priority over <font color="#0000FF">DRelayTrapTarget</font>.<br>
<br>
As a TOn, TOff message you can also send a Stim to do this, first enter the intensity surrounded by square brackets, followed by the stim name. For example: [ScriptName]TOn="[5.00]WaterStim".<br>
<br>
<b>Design Note example</b><br>
NVRelayTrapOn="+TurnOn+BashStimStimulus";NVRelayTrapTOn="+TurnOn+[5]FireStim";NVRelayTrapOnTarget="+player+^ZombieTypes"<br>
<br>
What will happen:<br>
On TurnOn or when bashed it will send a TurnOn and a FireStim with intensity 5 to the player and the closest Zombie.(relative to the object with the script)<br>
As nothing else is specified on TurnOff will send a TurnOff to all ControlDevice linked objects.
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:228px;"><span style="font-family: Tahoma"><b>DDrunkPlayerTrap</b>
On <u>TurnOn</u> makes you drunk a <u>TurnOff</u> sober.
Multiple Ons from the same source will reset the timer and will do a FadeIn again. Multiple sources do stack.

Optional parameters:
<font color="#0000FF">DDrunkPlayerTrapStrength</font>        regulates the strength basically every number can be used I would suggest something between 0 and 2                default=1
<font color="#0000ff">DDrunkPlayerTrapInterval</font>        a second regulator how often the effect is applied. With a lower interval higher strength becomes more acceptable.         default[seconds]=0.2 
<font color="#0000ff">DDrunkPlayerTrapLength </font>        How long the effect will last in seconds. Use 0 for until <u>TurnOff</u> is received                                    default[seconds]=0    
<font color="#0000ff">DDrunkPlayerTrapFadeIn</font>        Fades in the effect over the given time at the end the full strength is used.                                default[seconds]=0
<font color="#0000ff">DDrunkPlayerTrapFadeOut</font>        <b>Only works if Length is set</b>! Will gradually make the effect weaker over the last given seconds.                    default[seconds]=0
<font color="#0000FF">DDrunkPlayerTrapMode</font>            The effect is made up by 1) shaking the camera and 2) Pushing the player.(left/right/forward).                     default=3
                        By setting Mode to 1 or 2 you can use one effect only. Especially for Mode=2 higher Strength values can be used.

</span>
<b>Check out the demo how this can be used as a potion.</b>
NOTE: v0.22: it's Savegame compatible now.
I think you can also create some interesting effects with an early FadeOut and Repeats.</pre>
</div><br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DCopyPropertyTrap<br>
</b><br>
Target default: &amp;ScriptParams<br>
Source default: [me]<br>
<br>
Similar to S&amp;R-&gt;SetProperty but can set multiple properties on multiple objects at the same time.<br>
<br>
Upon receiving <u>TurnOn</u> copies the properties specified by <font color="#0000FF"><u>DCopyPropertyTrapProperty</u></font> form the object <font color="#0000FF"><u>DCopyPropertyTrapSource</u></font>(default is [me]) to the objects specified through <font color="#0000FF">DCopyPropertyTrapTarget</font> if not set<u>ScriptParams</u> linked objects will receive the propertie(s) by default.<br>
Multiple properties can be copied with the + operator.<br>
<br>
You use the script object as a sender or receiver.<br>
<br>
<b>Design Note example:</b><br>
DCopyPropertyTrapProperty=""+PhysControl+RenderAlpha";DCopyPropertyTrapSource="&amp;Owns";DCopyPropertyTrapTarget="[me]"<br>
This will copy the Physics-&gt;Controls and Renderer-&gt;Transparency(Alpha) property from the object linked with an Owns linked to the object itself.
			
		</div>
	</div>
</div><br>
<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DWatchMe</b><br>
By default when this object is created or at game start (<u>BeginScript</u>) creates <u>AIWatchObj</u> Links from all <u>Human(-14)</u> to this object.<br>
Alternatively an alternate <font color="#0000CD"><i>DWatchMeOn</i></font> message can be used, as well as <font color="#0000CD"><i>DWatchMeTarget</i></font> to specify another object, archetype or metaproperty.(see notes below)<br>
<br>
•Further (if set) <b>copies!!</b> the <b>AI-&gt;Utility-&gt;Watch links default</b> property of the archetype (or the closest ancestors with this property) and sets the <b>Step 1 - Argument 1 </b> to the Object ID of this object.<br>
•Alternatively if no ancestor has this property the property of the script object will be used and NO arguments will be changed. (So it will behave like the normal T1/PublicScripts WatchMe or NVWatchMeTrap scripts).<br>
<br>
On <u>TurnOff</u> will remove any(!) <u>AIWatchObj</u> links to this object. You maybe want to set DWatchMeOff="Null".<br>
------------------------------<br>
<b>Usefullness:</b><br>
If you have multiple objects in your map and want that AIs perform simple(?) actions with each of them under certain conditions.<br>
For example:<br>
You can use it to let guards relight every extinguished torches on their patrol path -&gt; see Demo.<br>
Initially it was designed to be used with DPortal do force an alerted AI to follow the player through portals. Still not optimal but the basics are there.<br>
<br>
<b>Tip:</b><br>
If you use a custom On command, multiple links could be created so you may want to set the Watch-&gt;"Kill like links" flag in that situation.<br>
<br>
<b>Design Note Examples:</b><br>
DWatchMeOn="WaterStimStimulus";DWatchMeTarget="@guard";DWatchMeFailChance=60<br>
DWatchMeOn="TurnOn";DWatchMeTarget=42<br>
DWatchMeTarget=ValidObjectName<br>
DWatchMeTarget=*swordsman
			
		</div>
	</div>
</div><br>
--------------------------------------------------------<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DTPBase</b><br>
Base script for the other 3 scripts. Has by itself no use.<br>
•If a patrolling AI is teleported it will reassume its patrol after teleportation from the now closest Patrol Point.<br>
•Contains the DTeleportation(who,where) function which teleports a given object to absolute world coordinates.
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DTeleportPlayerTrap</b><br>
•Upon receiving <u>TurnOn</u> moves the player by x,y,z values specified in the Design Note via <i><font color="#0000CD">DTpX=;DTpY=;DTpZ=</font></i>. Use for 100% Seamless teleportation.<br>
•If no parameter is set or all are 0 then the player gets teleported to the location of this object instead.<br>
<br>
<b>Design Note Example:</b><br>
DTpX=-3.5;DTpZ=10
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DTrapTeleporter<br>
<br>
Target default: <font color="#0000FF">&amp;Control Device</font></b><br>
<br>
Upon receiving <u>TurnOn</u> teleports a <u>ControlDevice</u> linked object to this object and keeps the original rotation of the object.<br>
Further by default currently non-moving or non-AI objects will be static at the position of the TrapTeleporter and not affected by gravity until their physics are enabled again - for example by touching them.<br>
By setting <i><font color="#0000FF">DTeleportStatic=0</font></i> in the Editor-&gt;Design Note they will be affected by gravity after teleportation. Does nothing if Controls-&gt;Location is set.<br>
<br>
<b>Design Note Example:</b><br>
DTeleportStatic=0<br>
DTrapTeleporterTarget=@Zombie types
			
		</div>
	</div>
</div><div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b>DPortal</b><br>
<br>
DefOn ="PhysEnter"<br>
Default Target = Entering Object. (not [source]!)<br>
<br>
Teleports <b><u>any entering object</u></b><u> (PhysEnter)</u>.<br>
Either by x,y,z values specified in the Design Note via <i><font color="#0000CD">DTpX=;DTpY=;DTpZ=</font></i> or to object linked with <u>ScriptParams</u>. If a value in the Design Note is specified the first option takes priority!<br>
Unlike DTeleportPlayerTrap this script takes the little offset between the player and the portal center into account, which enables a 100% seamless transition - necessary if you want to trick the player.<br>
<br>
<b>Design Note Example:</b><br>
DTpX=-3.5;DTpZ=10<br>
DPortalTarget="+player+#88+@M-MySpecialAIs"<br>
<b>Tip</b><br>
If you use the ScriptParams link and want a seamless transition, place the destination object ~3 units above the ground
			
		</div>
	</div>
</div>---------------------------------------------------<br>
<br>
<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<font color="#FF8C00"><u><b><font size="3">DScript 0.28a Squirrel Features</font></b></u></font><br>
These features/functions specified here are globally available to who has the DScript.nut file and are not bind to the DBaseTrap.<br>
<br>
<font color="#FF8C00"><b>DGetParam("FullParameterName",DefaultValue, Table ,adv=0)</b></font><br>
Returns the parameter in the DesignNote if none is present the DefaultValue instead. The 3rd parameter is where you actually look most of the time you will pass the Design Note (userparams()) on here but also check in every other table-like structure like classes.<br>
if a value is found or else the default it will be analyzed by:<br>
<br>
<b><font color="#FF8C00">DCheckString(r,adv)</font></b><br>
This function analyzed the given string r and performs the operator checks as listed in DBaseScript. @,&amp;,[me],+ ...<br>
Each found object will be stored in an array. If <font color="#FF8C00">adv = true</font> the whole array will be returned and can be used for foreach (t in array){ ... }. Else if adv=0/false only a single value will be returned.<br>
<br>
<b><font color="#FF8C00">DGetStringParam("FullParameterName",DefaultValue, String ,adv=0)</font></b><br>
Identically to DGetParam but that this function takes strings which are formatted like this: "ParameterName=Value;Key=Value2". DCheckString is then called as well.<br>
<br>
<b><br>
<font color="#FF8C00">DGetAllDescendants(Archetype,array)</font></b><br>
Returns all concrete descendants of an archetype and all other inherited archtypes in an array. The function must be given an array to work with all found objects will be added to that array.<br>
<br>
<font color="#FF8C00">DCountCapaCheck(Script Name, Design Note, true/false for On/Off) and DCapacitorCheck</font><br>
These handle partly the Count and Capacitor parameters for the DBaseTrap and then call the DoOn/Off functions. As they are global functions I noted them here but they will not work as standalone.<br>
<br>
<font color="#FF8C00"><br>
<b>DArrayToString(Array , Seperator ="+"</b>)</font> converts an array to a string with the character defined by Seperator between them, default +. The reverse to string split.<br>
<br>
<b><font color="#FFA07A">DSendMessage</font>(Target, Message)</b> (need extends DRelayTrap)<br>
Will send a single <i>Message</i> to a single <i>Target</i> and check if the <i>Message</i> should be a Stim. If so it will stimulate the Target.<br>
<br>
<br>
<b><font color="#FFA07A">DRelayMessages</font>("On" or "Off", DesignNote)</b> (need extends DRelayTrap)<br>
Will relay the Message<b>s</b> in [ScriptName]T[On/Off] to the objects [ScriptName][On/Off]TDest via DSendMessage.<br>
<br>
--------------<br>
<div class="bbcode_container">
	<div class="bbcode_quote">
		<div class="quote_container">
			<div class="bbcode_quote_container"></div>
			
				<b><font color="#FF8C00">DSetTimerData</font></b>(name, delay,...[data you want to attach]) returns timer_handle<br>
<b><font color="#FF8C00">DSetTimerDataTo</font></b>(To,name,delay,...) same as above but sent to To instead of self.<br>
<font color="#FF8C00"><b>DGetTimerData</b></font>(msgdata,KeyValue=false) returns an Array with your data.<br>
<br>
The functions start a timer with multiple data attachments which can be returned later in an array out of the message().data.<br>
This Data is save game compatible!<br>
<br>
--------------<br>
But now let me explain why these functions are important/usefull:<br>
If there time gap between 2 actions, there is always the problem how to safely carry over data. The (human) player could save and reload the game in the meantime and all non persistent data will be whipped as new script instances are recreated (that's how I understood it).<br>
The relevant persistent data are script data set with SetData(k,v), QVars and timers.<br>
<br>
I don't know it but I think NV came up with something similar so I take an NVRelayTrap as an example: which inverts the message and sends it twice back to the sender (with a delay).<br>
So now we got two objects sending a TurnOn and TurnOff to the Trap and here's the problem a) after the delay how to know which object sent the message? b) What was the message again? and c) how to know if it's first message and needs to be send again?<br>
We would need to save three values. But SetOneShotTimer only has one data slot. The second message would override the first SetData or QVar. Well you could store multiple ScriptData with a prefix and save that prefix in the timer data slot, but I think memory wise that's not the best solution, also it would increase very fast if you need to transfer even more data.<br>
Btw: Squirrel somehow lacks the SetTimedMessage(2) function why?.<br>
<br>
--------------<br>
<br>
Data can be stored and retrieved in a fixed order (KeyValue=false) or in a not sorted Key=Value manner, for the later see below. As an example for the sorted manner if you know the first data is always the source and the second the are repeats left. Returned Array will be[source Obj ID, Repeats left]<br>
And you can use array[0],array[1] to grab your data.<br>
<br>
If there are other data you want to store but for example some are optional or whatever you can store them via key=value,key2=value2,...<br>
now if you use KeyValue=true the array will look like this [key,value,key2,value2] and you can search and find your values like this:<br>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:96px;">local array=DGetTimerData(message().data,true)
local key = array.find(param);
loval value =0

if (key!=null)
    {value =array[key+1]}</pre>
</div>Take a look at the DDrunkPlayerTrap how I made use of that.
			
		</div>
	</div>
</div><br>
<br>
			
		</div>
	</div>
</div><br>
<br>
<br>
-----------------------------------<br>
<font size="3"><b><br>
Installation</b></font><br>
<br>
##NewDark+Squirrel Installation##<br>
1. Be sure to have at least <a href="http://www.ttlg.com/forums/showthread.php?t=147689" target="_blank">NewDark 1.25 </a><br>
2. Beside new_dark.zip and editor.zip inside the NewDark1.25.zip open contrib.zip and export squirrel.osm into your main folder.<br>
3. If not present create a folder named <i>sq_scripts</i> in your main folder.<br>
<br>
##Script Installation##<br>
1. Download<br>
2. Extract the contents of the .zip directly into your main folder or the DScript.nut into your sq_scripts folder<br>
3. In the editor script_load squirrel
						</blockquote>
